<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Simple - Analizador</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .code-line { 
            padding: 5px; 
            cursor: pointer; 
            border: 1px solid #ccc; 
            margin: 2px 0;
            background: #f9f9f9;
        }
        .code-line:hover { background: #e0e0e0; }
        .code-line.selected { background: #007bff; color: white; }
        .verify-button { 
            padding: 10px 20px; 
            margin: 10px 0; 
            background: #28a745; 
            color: white; 
            border: none; 
            cursor: pointer; 
        }
        .verify-button:disabled { 
            background: #ccc; 
            cursor: not-allowed; 
        }
        .debug { background: #f0f0f0; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Test Simple - Selecci√≥n de L√≠neas</h1>
    
    <div id="debug-info" class="debug">
        <strong>Debug Info:</strong>
        <div id="debug-output">Iniciando...</div>
    </div>
    
    <h3>Pregunta 1: Buffer Overflow en C</h3>
    <p>Selecciona las l√≠neas vulnerables:</p>
    
    <div id="code-container">
        <div class="code-line" data-line-number="1">1: #include &lt;stdio.h&gt;</div>
        <div class="code-line" data-line-number="2">2: #include &lt;string.h&gt;</div>
        <div class="code-line" data-line-number="3">3: </div>
        <div class="code-line" data-line-number="4">4: void vulnerable_function(char *input) {</div>
        <div class="code-line" data-line-number="5">5:     char buffer[100];</div>
        <div class="code-line" data-line-number="6">6:     strcpy(buffer, input);  // Vulnerable line</div>
        <div class="code-line" data-line-number="7">7:     printf("Input: %s\\n", buffer);</div>
        <div class="code-line" data-line-number="8">8: }</div>
        <div class="code-line" data-line-number="9">9: </div>
        <div class="code-line" data-line-number="10">10: int main() {</div>
        <div class="code-line" data-line-number="11">11:     char user_input[200];</div>
        <div class="code-line" data-line-number="12">12:     gets(user_input);  // Also vulnerable</div>
        <div class="code-line" data-line-number="13">13:     vulnerable_function(user_input);</div>
        <div class="code-line" data-line-number="14">14:     return 0;</div>
        <div class="code-line" data-line-number="15">15: }</div>
    </div>
    
    <button id="verify-button" class="verify-button" disabled>üîç Verificar Respuesta</button>
    
    <div id="result" style="margin-top: 20px;"></div>
    
    <script>
        const selectedLines = new Set();
        const correctLines = [6, 12];
        const debugOutput = document.getElementById('debug-output');
        const verifyButton = document.getElementById('verify-button');
        const resultDiv = document.getElementById('result');
        
        function updateDebug(message) {
            debugOutput.innerHTML += '<br>' + new Date().toLocaleTimeString() + ': ' + message;
            console.log(message);
        }
        
        // Add click handlers to code lines
        document.querySelectorAll('.code-line').forEach(line => {
            line.addEventListener('click', function() {
                const lineNumber = parseInt(this.getAttribute('data-line-number'));
                updateDebug(`Clicked line ${lineNumber}`);
                
                if (selectedLines.has(lineNumber)) {
                    selectedLines.delete(lineNumber);
                    this.classList.remove('selected');
                    updateDebug(`Deselected line ${lineNumber}`);
                } else {
                    selectedLines.add(lineNumber);
                    this.classList.add('selected');
                    updateDebug(`Selected line ${lineNumber}`);
                }
                
                // Update button state
                verifyButton.disabled = selectedLines.size === 0;
                verifyButton.textContent = selectedLines.size > 0 
                    ? `üîç Verificar Respuesta (${selectedLines.size} l√≠neas)`
                    : 'üîç Verificar Respuesta';
                
                updateDebug(`Selected lines: [${Array.from(selectedLines).sort().join(', ')}]`);
                updateDebug(`Button disabled: ${verifyButton.disabled}`);
            });
        });
        
        // Verify button handler
        verifyButton.addEventListener('click', function() {
            updateDebug('Verify button clicked');
            
            const userAnswer = Array.from(selectedLines).sort();
            const correctAnswer = correctLines.sort();
            
            updateDebug(`User answer: [${userAnswer.join(', ')}]`);
            updateDebug(`Correct answer: [${correctAnswer.join(', ')}]`);
            
            const isCorrect = JSON.stringify(userAnswer) === JSON.stringify(correctAnswer);
            
            resultDiv.innerHTML = `
                <h3>Resultado:</h3>
                <p><strong>Tu respuesta:</strong> L√≠neas ${userAnswer.join(', ')}</p>
                <p><strong>Respuesta correcta:</strong> L√≠neas ${correctAnswer.join(', ')}</p>
                <p><strong>Resultado:</strong> ${isCorrect ? '‚úÖ Correcto' : '‚ùå Incorrecto'}</p>
                ${!isCorrect ? `
                    <p><strong>Explicaci√≥n:</strong> Las l√≠neas vulnerables son:</p>
                    <ul>
                        <li>L√≠nea 6: strcpy() no verifica l√≠mites del buffer</li>
                        <li>L√≠nea 12: gets() es inherentemente insegura</li>
                    </ul>
                ` : ''}
            `;
            
            this.disabled = true;
            this.textContent = '‚úÖ Respuesta Verificada';
            
            updateDebug(`Verification complete. Result: ${isCorrect ? 'CORRECT' : 'INCORRECT'}`);
        });
        
        updateDebug('Test simple inicializado correctamente');
        updateDebug(`L√≠neas correctas: [${correctLines.join(', ')}]`);
    </script>
</body>
</html>